version: '3.9'

services:
  gateway:
    build:
      context: ./apps/gateway   # Path to your Nest.js Dockerfile
      dockerfile: Dockerfile
    container_name: gateway-service
    ports:
      - "3001:3000"           # Expose server on port 3001
    environment:
      NODE_ENV: production
    restart: unless-stopped

  client:
    build:
      context: ./apps/client   # Path to your Next.js Dockerfile
      dockerfile: Dockerfile
    container_name: client-app
    ports:
      - "3000:3000"           # Expose Next.js on port 3000
    environment:
      NODE_ENV: production
      NEXT_PUBLIC_API_URL: http://localhost:3000  # If client calls server
    depends_on:
      - gateway
    restart: unless-stopped
